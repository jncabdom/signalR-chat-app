{"ast":null,"code":"import _regeneratorRuntime from\"/home/nico/expero/toolkit/signalR-test/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/nico/expero/toolkit/signalR-test/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/nico/expero/toolkit/signalR-test/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/nico/expero/toolkit/signalR-test/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useRef}from'react';import{HubConnectionBuilder}from'@microsoft/signalr';import ChatWindow from'./ChatWindow';import ChatInput from'./ChatInput';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),connection=_useState2[0],setConnection=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),chat=_useState4[0],setChat=_useState4[1];var latestChat=useRef(null);latestChat.current=chat;useEffect(function(){var newConnection=new HubConnectionBuilder().withUrl('http://localhost:5241/hub').withAutomaticReconnect().build();setConnection(newConnection);},[]);useEffect(function(){if(connection){connection.start().then(function(result){console.log('Connected to C# Chat Backend!');connection.on('ReceiveMessage',function(message){var updatedChat=_toConsumableArray(latestChat.current);updatedChat.push(message);setChat(updatedChat);});}).catch(function(e){return console.log('Connection failed: ',e);});}},[connection]);var sendMessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(user,message){var chatMessage;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:chatMessage={user:user,message:message};if(!connection.connectionStarted){_context.next=12;break;}_context.prev=2;_context.next=5;return connection.send('SendMessage',chatMessage);case 5:_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](2);console.log(_context.t0);case 10:_context.next=22;break;case 12:connection.start();_context.prev=13;_context.next=16;return connection.send(\"SendMessage\",chatMessage);case 16:_context.next=21;break;case 18:_context.prev=18;_context.t1=_context[\"catch\"](13);console.log(_context.t1);case 21:alert('No connection to server yet.');case 22:case\"end\":return _context.stop();}},_callee,null,[[2,7],[13,18]]);}));return function sendMessage(_x,_x2){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(ChatInput,{sendMessage:sendMessage}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(ChatWindow,{chat:chat})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","HubConnectionBuilder","ChatWindow","ChatInput","jsx","_jsx","jsxs","_jsxs","Chat","_useState","_useState2","_slicedToArray","connection","setConnection","_useState3","_useState4","chat","setChat","latestChat","current","newConnection","withUrl","withAutomaticReconnect","build","start","then","result","console","log","on","message","updatedChat","_toConsumableArray","push","catch","e","sendMessage","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","user","chatMessage","wrap","_callee$","_context","prev","next","connectionStarted","send","t0","t1","alert","stop","_x","_x2","apply","arguments","children"],"sources":["/home/nico/expero/toolkit/signalR-test/client/src/Chat.js"],"sourcesContent":["\nimport React, { useState, useEffect, useRef } from 'react';\nimport { HubConnectionBuilder } from '@microsoft/signalr';\n\nimport ChatWindow from './ChatWindow';\nimport ChatInput from './ChatInput';\n\nconst Chat = () => {\n    const [ connection, setConnection ] = useState(null);\n    const [ chat, setChat ] = useState([]);\n    const latestChat = useRef(null);\n\n    latestChat.current = chat;\n\n    useEffect(() => {\n        const newConnection = new HubConnectionBuilder()\n            .withUrl('http://localhost:5241/hub')\n            .withAutomaticReconnect()\n            .build();\n\n        setConnection(newConnection);\n    }, []);\n\n    useEffect(() => {\n        if (connection) {\n            connection.start()\n                .then(result => {\n                    console.log('Connected to C# Chat Backend!');\n    \n                    connection.on('ReceiveMessage', message => {\n                        const updatedChat = [...latestChat.current];\n                        updatedChat.push(message);\n                    \n                        setChat(updatedChat);\n                    });\n                })\n                .catch(e => console.log('Connection failed: ', e));\n        }\n    }, [connection]);\n\n    const sendMessage = async (user, message) => {\n        const chatMessage = {\n            user: user,\n            message: message\n        };\n        if (connection.connectionStarted) {\n            try {\n                await connection.send('SendMessage', chatMessage);\n            }\n            catch(e) {\n                console.log(e);\n            }\n        }\n        else {\n            connection.start();\n                        try {\n                          await connection.send(\"SendMessage\", chatMessage);\n                        } catch (e) {\n                          console.log(e);\n                        }\n            alert('No connection to server yet.');\n        }\n    }\n\n    return (\n        <div>\n            <ChatInput sendMessage={sendMessage} />\n            <hr />\n            <ChatWindow chat={chat}/>\n        </div>\n    );\n};\n\nexport default Chat;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}